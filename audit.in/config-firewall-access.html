<H4><p style="background-color: #C0C0C0;">
Audit Check config-firewall-access
</H4><p>
Unrestricted access to services running on an ESXi host can exposes a host to outside 
attacks and unauthorized access.  Reduce the risk by configuring the ESXi firewall to 
only allow access to permitted services from authorized networks.

The firewall settings can be listed using the commands listed below.  
These settings need to be assessed manually against the corporate policies for 
authorization and access to each of the specific services.

</p>
<b><u>Audit Check:</b></u><pre>

To list the overall Status of the Firewall Service:
esxcli –s &LTserver ip&GT –u &LTusername&GT –p &LTpassword&GT network firewall get

To list the basic Firewall Rules:
esxcli –s &LTserver ip&GT –u &LTusername&GT –p &LTpassword&GT network firewall ruleset list

To list the allowed IP addresses for each Firewall Rule:
esxcli –s &LTserver ip&GT –u &LTusername&GT –p &LTpassword&GT network firewall ruleset allowedip list

In PowerCLI:
    # List all services for a host
    $services = Get-VMHost $esxh | Get-VMHostService
    # List the services which are enabled and have rules defined for specific IP ranges to access the service
    $specificrules = Get-VMHost $esxh | Get-VMHostFirewallException | Where {$_.Enabled -and (-not $_.ExtensionData.AllowedHosts.AllIP)}
    # List the services which are enabled and do not have rules defined for specific IP ranges to access the service
    $nonspecificrules = Get-VMHost $esxh | Get-VMHostFirewallException | Where {$_.Enabled -and ($_.ExtensionData.AllowedHosts.AllIP)}

</pre>
<b><u>Audit Results:</b></u>
<pre>
